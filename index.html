<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="calendar.css">
  </head>
  <audio id="bgMusic" src="./music.mp3" loop></audio>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const music = document.getElementById("bgMusic");
    if (!music) return;

    music.volume = 0.5;

    // Intento de "desbloqueo" suave: con el primer click/tecla, hover ya funcionará seguro
    const unlock = async () => {
      try {
        await music.play();
        music.pause();
        music.currentTime = 0;
      } catch (_) {}
      document.removeEventListener("click", unlock);
      document.removeEventListener("keydown", unlock);
      document.removeEventListener("touchstart", unlock);
    };
    document.addEventListener("click", unlock);
    document.addEventListener("keydown", unlock);
    document.addEventListener("touchstart", unlock, { passive: true });

    function attachHoverToEventDay() {
      const eventDay = document.querySelector(".day.has-event");
      if (!eventDay) return;

      eventDay.addEventListener("mouseenter", async () => {
        try {
          music.currentTime = 0;   // empieza desde el principio cada vez
          await music.play();
        } catch (e) {
          // Si está bloqueado, no sonará hasta que haya un click/tecla
          console.log("Audio bloqueado hasta interacción:", e);
        }
      });

      eventDay.addEventListener("mouseleave", () => {
        music.pause();
        music.currentTime = 0;
      });
    }

    // Al cargar
    attachHoverToEventDay();

    // Como regeneras el calendario al cambiar mes, re-engancha eventos
    document.getElementById("prev-month")?.addEventListener("click", () => setTimeout(attachHoverToEventDay, 0));
    document.getElementById("next-month")?.addEventListener("click", () => setTimeout(attachHoverToEventDay, 0));
  });
</script>

  <body>
</div>
    <div class="calendar">
      <div class="container">
        <div class="caltitle">
          カレンダー
        </div>
        <div class="container">
          <div class="inblock">
            <p id="fullDate1"></p>
          </div>
          <div class="calbar">
            <button id="prev-month">&lt;</button>
              <span id="japanese-month"></span>
            <button id="next-month">&gt;</button>
          </div>
        </div>
        <a href="https://www.instagram.com/oval____/?hl=en" 
   target="_blank" 
   class="oval-link">
  <img src="./Oval_Icona_Avatar_2560x1440_1.png" class="oval-image">
</a>

      </div>
      <div class="date">
        <span id="fullDate2"></span>
      </div>
      <div class="space"></div>
      <div class="days-of-week">
        <div class="day-of-week">月</div>
        <div class="day-of-week">火</div>
        <div class="day-of-week">水</div>
        <div class="day-of-week">木</div>
        <div class="day-of-week">金</div>
        <div class="day-of-week">土</div>
        <div class="day-of-week">日</div>
      </div>
      <div class="days" id="calendarDays"></div>
      <div class="container">
        <div class="clock" id="clock-left"></div>
        <div class="clock" id="clock-right"></div>
      </div>
  
</div>

<audio id="bgMusic" src="./music.mp3" preload="auto" loop></audio>

    </div>

<script src="calendar.js"></script>

<script>
  NekoType = "blue";
</script>
<script src="https://webneko.net/n20171213.js"></script>

<script>
  function findNekoElement() {
    return (
      document.getElementById("neko") ||
      document.querySelector(".neko") ||
      document.querySelector('img[src*="webneko"]')
    );
  }

  function placeNekoOverDateText() {
    const neko = findNekoElement();
    const dateLine = document.getElementById("fullDate2");
    if (!neko || !dateLine) return;

    const dateRect = dateLine.getBoundingClientRect();

    // Ajusta estos números a tu gusto
    const x = dateRect.left + 10;   // un poco a la derecha del texto
    const y = dateRect.top - 25;    // encima del texto

    // Si el neko usa coordenadas de página, añadimos el scroll
    const pageX = x + window.scrollX;
    const pageY = y + window.scrollY;

    neko.style.left = `${pageX}px`;
    neko.style.top = `${pageY}px`;
  }

  const waitNeko = setInterval(() => {
    if (findNekoElement()) {
      clearInterval(waitNeko);
      placeNekoOverDateText();
      setTimeout(placeNekoOverDateText, 300);
      window.addEventListener("resize", placeNekoOverDateText);
      window.addEventListener("scroll", placeNekoOverDateText);
    }
  }, 50);
</script>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const cover = document.getElementById("coverImage");
    const music = document.getElementById("bgMusic");

    if (!cover || !music) return;

    cover.addEventListener("click", async () => {
      try {
        music.volume = 0.5;

        if (music.paused) {
          await music.play();
        } else {
          music.pause();
        }
      } catch (err) {
        console.error(err);
        alert("El navegador bloqueó el audio. Prueba a hacer clic otra vez.");
      }
    });
  });
</script>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const cover = document.getElementById("coverImage");
    const music = document.getElementById("bgMusic");

    if (!cover || !music) return;

    cover.addEventListener("click", async () => {
      try {
        music.volume = 0.5;

        if (music.paused) {
          await music.play();
        } else {
          music.pause();
        }
      } catch (err) {
        console.error(err);
        alert("El navegador bloqueó el audio. Prueba a hacer clic otra vez.");
      }
    });
  });
</script>

</body>
</html>


